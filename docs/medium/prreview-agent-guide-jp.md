# my-hack-pr-review カスタムエージェントガイド

このガイドでは、**my-hack-pr-review** カスタムエージェント（`my-hack-pr-review.agent.md`）を使って、素早く一貫性のある Pull Request レビューを最小限の成果物で実施する方法を説明します。my-hack-arch-diagram ガイドと同じ構成ですが、インフラ可視化ではなくコードレビューにフォーカスしています。

> 目的: コード品質・リスク・次のアクションに集中した軽量な PR レビューを提供し、不要なドキュメント生成を避ける。

> **Note**: VS Code 1.106（2025年10月）以前では、カスタムエージェントは「chat mode」と呼ばれ、`.chatmode.md` ファイルを `.github/chatmodes/` ディレクトリに置いていました。機能は同じですが、用語とディレクトリ構造が変わっています。

## 🧭 概要

my-hack-pr-review エージェントは Pull Request の差分を解析し、影響度と重大度で分類したレビュー成果物 (`summary.md` と `comments.md`) を生成します。コードを変更したり過剰なドキュメントを作成したりせず、統一されたレビュー出力を得られます。

## ✅ 前提条件

- 変更内容が存在するブランチ
- diff(差分)を取得できる Git リポジトリ
- プロジェクトのコード構造に関する基本的な理解

## 🎯 このエージェントを使うタイミング

my-hack-pr-review カスタムエージェントは以下の場合に利用します。
- マージ前に素早く一貫した PR レビューを行いたい
- コード品質・セキュリティ・パフォーマンスに関する体系的なフィードバックが欲しい
- PR に投稿できるドラフトコメントを準備したい
- 深い手動レビューなしでリスクを評価したい

コード生成や問題修正が目的の場合は my-hack-planner などの他エージェントを利用してください。

## ⚡ クイックスタート

1. my-hack-pr-review カスタムエージェントに切り替える
2. レビューを依頼: `Review this PR` や `Review changes against main`
3. エージェントが以下を実行:
    - 現在のブランチとベース（デフォルト: `main`）の差分を取得
    - コード変更を解析して品質・セキュリティ・パフォーマンスの課題を特定
    - 重大度 (Blocker / Should Fix / Optional) ごとに分類
    - `.copilot-tracking/pr-review/` にレビュー成果物を生成
4. 生成ファイルを確認:
    - `summary.md` – 要約と意思決定を記載した 1 ページレポート
    - `comments.md` – PR に投稿できるドラフトコメント集

コマンド例:
```
Review the changes in branch feat/ayaka/add-fruit-price-api compared to main
```

## 📁 出力構成

すべてのレビュー成果物は次の場所に出力されます。
```
.copilot-tracking/pr-review/
├── summary.md      # 概要、判断、リスク評価
└── comments.md     # ファイル・行別のレビューコメント
```

## 📋 レビュー分類

エージェントは以下の分類を使用します。

**Impact レベル:**
- **High**: 機能やセキュリティに重大な影響
- **Medium**: 保守性やパフォーマンスに重要な改善
- **Low**: Nice-to-have な提案

**カテゴリ:**
- **Quality**: コード構造、可読性、ベストプラクティス
- **Security**: 脆弱性、危険なパターン、アクセス制御
- **Performance**: 効率性、リソース使用、最適化
- **Docs**: ドキュメンテーションの完全性と正確性
- **Ops**: デプロイ、設定、運用上の懸念

**Severity:**
- **Blocker**: マージ前に修正が必須
- **Should Fix**: 強く修正を推奨
- **Optional**: あると望ましい改善

## 🔄 典型的なワークフロー

1. **PR を作成・更新**: 変更をブランチに push
2. **レビューを依頼**: my-hack-pr-review エージェントに切り替えてレビューをリクエスト
3. **出力を確認**: `.copilot-tracking/pr-review/summary.md` の概要を確認
4. **Blocker を解消**: マスト修正項目を対処
5. **コメントを投稿**: `comments.md` を PR コメントの下書きとして活用
6. **再実行**: 修正後に再レビューで解消を確認

## 🎨 出力フォーマット

### summary.md
含まれる情報:
- PR タイトル・スコープとレビュー判断（Block / Approve with suggestions / Approve）
- 主な指摘の概要
- リスクと影響度の評価
- Must-Fix / Should-Fix / Nice-to-Have のカテゴリ別整理
- 次のステップのチェックリスト

### comments.md
含まれる情報:
- 番号付きコメント（C-001, C-002 など）
- ファイルと行番号の参照
- カテゴリと重大度のタグ
- 問題の説明、提案修正（diff 形式）、根拠の解説

## 💡 ヒント

- **早めに実行**: マージ直前ではなく開発途中からレビューを活用
- **Blocker に注力**: 重大項目から優先して対応
- **ドラフトとして活用**: `comments.md` をベースに PR コメントを投稿
- **素早く回す**: 修正後は再実行して解消を確認
- **比較先を調整**: ベースブランチを feature や staging に変更することも可能
